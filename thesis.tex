% -*- latex -*- This is a LaTeX document.
% $Id: thesis.tex,v 1.8 1999-05-08 00:18:34 cananian Exp $
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[12pt,notitlepage,twoside]{article}
%\documentclass[12pt,notitlepage,twocolumn,twoside]{article}
\usepackage{comdef}

% the name of the project
\newcommand{\magic}{\textsc{Magic}}

% double-space
\renewcommand{\baselinestretch}{1.2}

\title{\magic: An Optimizing Java Compiler using SSI Form}
\author{C. Scott Ananian}
\date{\today \\ $ $Revision: 1.8 $ $}

\begin{document}
\pagestyle{myheadings}\markboth{$ $Revision: 1.8 $ $}{$ $Revision: 1.8 $ $}
\bibliographystyle{plain}

\maketitle

\section{Introduction}
The choice of compiler internal representation is fundamental.
Advances in IRs translate to advances in compilers.
This paper represents another advance in IRs.
\textbf{blah, blah, blah}.

\section{Intermediate Representations}
\section{Static Single Assignment Form}
Static Single Assignment (SSA) form, introduced by Cytron in
\cite{cytron89:ssa}%
\footnote{Earlier reference in \cite{alpern88:ssa}?}
\ldots

\textbf{Define SSA form here.}

Figure \ref{fig:tossa} illustrates the conversion to SSA form.
\begin{figure}\label{fig:tossa}
\begin{center}
\input{Figures/THex1base} \vline\ \input{Figures/THex1ssa}
\end{center}
\caption{\phifunction{s} are added to the program on the left to
produce the SSA-form IR on the right.}
\end{figure}

\subsection{Minimal and pruned SSA forms}
Cytron defines a minimal SSA form in \cite{cytron91:ssa}.  His minimal
form is defined to use the smallest number of \phifunction{s} such
that the following three conditions hold:
\begin{enumerate}
\item If two nonnull paths $X \pathplus Z$ and $Y \pathplus Z$
converge at a node $Z$, and nodes $X$ and $Y$ contain assignments to
[a variable] $V$ (in the original program), then a trivial
\phifunction{} $V \leftarrow \phi(V, \ldots, V)$ has been inserted at
$Z$ (in the new program). \label{criteria1}
\item Each mention of $V$ in the original program or in an inserted
\phifunction{} has been replaced by a mention of a new variable $V_i$,
leaving the new program in SSA form.
\item Along any control flow path, consider any use of a variable $V$
(in the original program) and the corresponding use of $V_i$ (in the
new program).  Then $V$ and $V_i$ have the same value.
\end{enumerate}
Of these criteria, the first %\ref{criteria1}
is the most important.
%The other two can be summarized by noting that in proper SSA form,
%there is exactly one reaching definition for a variable $V$ at every
%non-$\phi$ use of $V$.
The SSA form in figure \ref{fig:tossa} is minimal.

A variation
on minimal SSA form, called \textit{pruned} form \cite{ferrante91:pruned},
avoids placing \phifunction{s} which define variables which are never used.
In most cases, the more regular properties of minimal SSA form
outweigh the pruned form's slight increase in space efficiency.
Figure \ref{fig:prunedssa} compares minimal and pruned SSA form for
our example program.
\begin{figure}\label{fig:prunedssa}
\begin{center}
\input{Figures/THex1ssa} \vline\ \input{Figures/THex1ssaPr}
\end{center}
\caption{Minimal SSA form on the left; pruned SSA form on the right.}
\end{figure}

\section{Static Single Information Form}

SSI form extends SSA form to achieve symmetry for both forward and
reverse dataflow.   SSI form recognizes that information about
variables is generated at branches and generates new names at these
points.  This provides us with a one-to-one mapping between variable
names and information about those variables which is independant of
control-flow graph context.  Analyses can then associate information
with variable names and propagate this information efficiently and
directly both with and against the dataflow direction.

\subsection{Definition of SSI form}
Building SSI form involves adding pseudo-assignments for a variable $V$:
\begin{enumerate}
\item[$(\phi)$] at a control-flow merge when disjoint paths from a
conditional branch come together and at least one of the paths
contains a definition of $V$; and
\item[$(\sigma)$] at locations where control-flow splits and at least
one of the disjoint paths from the split uses the value of $V$.
\end{enumerate}

Figure \ref{fig:tossi} compares the SSA and SSI forms for our example program.
% add text here about how SSI is better.
\begin{figure}\label{fig:tossi}
\begin{center}
\input{Figures/THex1ssa} \vline\ \input{Figures/THex1ssi}
\end{center}
\caption{SSA form on the left; SSI form on the right.}
\end{figure}

\subsection{Minimal and pruned SSI forms}
\textit{Minimal} and \textit{pruned} SSI forms can be defined which
parallel their SSA counterparts.  \textit{Minimal} SSI form would have the
smallest number of $\phi$- and \sigfunction{s} such that:
\begin{enumerate}
\item If two nonnull paths $X \pathplus Z$ and $Y \pathplus Z$
exist having only the node $Z$ where they converge in common,
and nodes $X$ and $Y$ contain either assignments to a variable $V$ in the
original program or a $\phi$- or \sigfunction{} for $V$ in the new program,
then a \phifunction{} for $V$ has been inserted at $Z$ in the new program.
\item If two nonnull paths $Z \pathplus X$ and $Z \pathplus Y$
exist having only the node $Z$ where they diverge in common,
and nodes $X$ and $Y$ contain either uses of a variable $V$ in the
original program or a $\phi$- or \sigfunction{} for $V$ in the new program,
then a \sigfunction{} for $V$ has been inserted at $Z$ in the new program.
\item There is exactly one reaching definition of $V$ at every
non-$\phi$ use of $V$ in the new program.
\item \textbf{FIXME: what's the equivalent condition for \sigfunction{s}?}
% has something to do with cycle equivalence.
\end{enumerate}

A \textit{pruned} SSI form would be the minimal form without any unused
definitions, that is, $\phi$ or \sigfunction{s} after which there are no
subsequent uses of any of the variables defined on the left-hand side,
except in other $\phi$ or \sigfunction{s}.\footnote{An even more
compact SSI form may be produced by removing \sigfunction{s} for which
there are uses for \textit{exactly one} of the variables on the
left-hand side, but it does not seem profitable to split this
particular hair.}

Figure \ref{fig:prunedssi} compares minimal and pruned SSI form for
our example program.
\begin{figure}\label{fig:prunedssi}
\begin{center}
\input{Figures/THex1ssi} \vline\ \input{Figures/THex1ssiPr}
\end{center}
\caption{Minimal SSI form on the left; pruned SSI form on the right.}
\end{figure}

\section{Results}
\section{Conclusions}

\bibliography{harpoon}
\appendix
\end{document}
