#!/bin/sh
# concatanate files to stdout in a form that we can unmunge them from.
# Basically, a text-file-only form of tar.
for dir in $@; do
  # filter out CVS directorys, backup files, and some obvious binary formats.
  files=`find $dir -name CVS -prune -o ! -name "*~" ! -name "*.class" ! -name "*.gif" -print`
  for f in $files; do
    if [ -f $f ]; then
	# pipeline safe: don't output anything until we're done reading it all.
	doctmp=`mktemp -q /var/tmp/doc-tmp.$$.XXXXXX`
	if [ $? -ne 0 ]; then
	    echo "$0: Can't create temp file, aborting."
	    exit 1
	fi
	echo "---- CUT HERE ----" >> $doctmp
        echo $f >> $doctmp
	# old way: sed -e "s/^-/- /" < $f
	# new way makes sure every line ends in a newline.
	perl -ne 'chomp;s/^-/- /;print $_ . "\n";' < $f >> $doctmp
	# NOW output.
	cat $doctmp ; rm -f $doctmp
    fi
  done
done
