echo Welcome to the FLEX installer.
echo 
echo Please E-mail Wes Beebee \<wbeebee@mit.edu\> if you have
echo any questions.
echo
echo 1\) Standard FLEX Java compiler install
echo 2\) Custom FLEX install

export inst=
while [ x$inst = x ]; do
  read -p "Choose an install: " inst leftover;
  case $inst in
     1) export arm=N;
	export GUI=N;
	export version='-A';
	export RTJ=N;;
     2) export arm=;
	export GUI=;
	export version=;
	export RTJ=;;
     *) export inst=;;
  esac;
done

while [ x$arm = x ]; do
  read -p "Do you want support for cross-compiling to StrongARM (Y/N)? " arm leftover;
  case $arm in
     y* | Y*) export arm=Y;;
     n* | N*) export arm=N;;
     *) export arm=;;
  esac;
done

while [ x$GUI = x ]; do
  read -p "Do you want GUI support (experimental) (Y/N)? " GUI leftover;
  case $GUI in
     y* | Y*) export GUI=Y;;
     n* | N*) export GUI=N;;
     *) export GUI=;;
  esac;
done

echo Downloading dependencies...
if [ -f /etc/redhat-release ]; then 
   export WEB_ROOT=http://flex-cvs.csail.mit.edu/ImageRec/RPMS; 
   mkdir RPMS;
   cd RPMS;
   if fgrep -q -c '7.2' /etc/redhat-release; then 
      echo RedHat 7.2 detected.;

      wget -q $WEB_ROOT/noGUI/arm-linux-binutils-2.10-1.i386.rpm; 
      wget -q $WEB_ROOT/noGUI/arm-linux-classpath-libs-0.05-1.i386.rpm; 
      wget -q $WEB_ROOT/noGUI/arm-linux-gcc-2.95.2-2.i386.rpm; 
      wget -q $WEB_ROOT/noGUI/arm-linux-glibc-2.1.3-2.i386.rpm;

      wget -q $WEB_ROOT/noGUI/autoconf-2.53-8.noarch.rpm; 
      wget -q $WEB_ROOT/noGUI/automake-1.6.3-1.noarch.rpm; 
      wget -q $WEB_ROOT/noGUI/db3x-3.2.9-4.i386.rpm; 
      wget -q $WEB_ROOT/noGUI/jikes-1.18-2mdk.i586.rpm; 
      wget -q $WEB_ROOT/noGUI/perl-Test-Harness-2.26-2.noarch.rpm; 
      wget -q $WEB_ROOT/noGUI/perl-modules-5.6.1-66.i386.rpm; 
   fi;
   if fgrep -q -c '7.3' /etc/redhat-release; then 
      echo RedHat 7.3 detected.; 
      wget -q $WEB_ROOT/noGUI/arm-linux-binutils-2.10-1.i386.rpm; 
      wget -q $WEB_ROOT/noGUI/arm-linux-classpath-libs-0.05-1.i386.rpm; 
      wget -q $WEB_ROOT/noGUI/arm-linux-gcc-2.95.2-2.i386.rpm; 
      wget -q $WEB_ROOT/noGUI/arm-linux-glibc-2.1.3-2.i386.rpm; 
      wget -q $WEB_ROOT/noGUI/autoconf-2.53-8.noarch.rpm; 
      wget -q $WEB_ROOT/noGUI/automake-1.6.3-1.noarch.rpm; 
      wget -q $WEB_ROOT/noGUI/db3x-3.2.9-4.i386.rpm; 
      wget -q $WEB_ROOT/noGUI/jikes-1.18-2mdk.i586.rpm; 
      wget -q $WEB_ROOT/noGUI/perl-Test-Harness-2.26-2.noarch.rpm; 
      wget -q $WEB_ROOT/noGUI/perl-modules-5.6.1-66.i386.rpm; 
   fi
   if fgrep -q -c '8.0' /etc/redhat-release; then 
      echo RedHat 8.0 detected.;
      wget -q $WEB_ROOT/ORBit-devel-0.5.13-5.i386.rpm;
      wget -q $WEB_ROOT/Xft-2.0-1.i386.rpm;
      wget -q $WEB_ROOT/Xft-devel-2.0-1.i386.rpm;
      wget -q $WEB_ROOT/arm-linux-binutils-2.10-1.i386.rpm;
      wget -q $WEB_ROOT/arm-linux-classpath-libs-0.05-1.i386.rpm;
      wget -q $WEB_ROOT/arm-linux-gcc-2.95.2-2.i386.rpm;
      wget -q $WEB_ROOT/arm-linux-glibc-2.1.3-2.i386.rpm;
      wget -q $WEB_ROOT/atk-1.0.3-1.i386.rpm;
      wget -q $WEB_ROOT/atk-devel-1.0.3-1.i386.rpm;
      wget -q $WEB_ROOT/audiofile-devel-0.2.3-3.i386.rpm;
      wget -q $WEB_ROOT/autoconf-2.53-8.noarch.rpm;
      wget -q $WEB_ROOT/automake-1.6.3-1.noarch.rpm;
      wget -q $WEB_ROOT/db3x-3.2.9-4.i386.rpm;
      wget -q $WEB_ROOT/esound-0.2.28-1.i386.rpm;
      wget -q $WEB_ROOT/esound-devel-0.2.28-1.i386.rpm;
      wget -q $WEB_ROOT/fontconfig-2.0-3.i386.rpm;
      wget -q $WEB_ROOT/fontconfig-devel-2.0-3.i386.rpm;
      wget -q $WEB_ROOT/freetype-2.1.2-7.i386.rpm;
      wget -q $WEB_ROOT/freetype-devel-2.1.2-7.i386.rpm;
      wget -q $WEB_ROOT/glib2-2.0.6-2.i386.rpm;
      wget -q $WEB_ROOT/glib2-devel-2.0.6-2.i386.rpm;
      wget -q $WEB_ROOT/glibc-2.3.2-4.80.i386.rpm;
      wget -q $WEB_ROOT/glibc-common-2.3.2-4.80.i386.rpm;
      wget -q $WEB_ROOT/gnome-libs-1.4.1.2.90-22.i386.rpm;
      wget -q $WEB_ROOT/gnome-libs-devel-1.4.1.2.90-22.i386.rpm;
      wget -q $WEB_ROOT/gtk2-2.0.6-8.i386.rpm;
      wget -q $WEB_ROOT/gtk2-devel-2.0.6-8.i386.rpm;
      wget -q $WEB_ROOT/gtk2-engines-1.9.0-4.i386.rpm;
      wget -q $WEB_ROOT/htmlview-2.0.0-6.noarch.rpm;
      wget -q $WEB_ROOT/jikes-1.18-1.i386.rpm;
      wget -q $WEB_ROOT/jikes-1.18-2mdk.i586.rpm;
      wget -q $WEB_ROOT/libart_lgpl-2.3.10-1.i386.rpm;
      wget -q $WEB_ROOT/libart_lgpl-devel-2.3.10-1.i386.rpm;
      wget -q $WEB_ROOT/libpng-1.2.2-8.i386.rpm;
      wget -q $WEB_ROOT/libpng-devel-1.2.2-8.i386.rpm;
      wget -q $WEB_ROOT/libpng10-1.0.13-6.i386.rpm;
      wget -q $WEB_ROOT/libpng10-devel-1.0.13-6.i386.rpm;
      wget -q $WEB_ROOT/libstdc++-3.2-7.i386.rpm;
      wget -q $WEB_ROOT/pango-1.1.1-1.i386.rpm;
      wget -q $WEB_ROOT/pango-devel-1.1.1-1.i386.rpm;
      wget -q $WEB_ROOT/perl-Test-Harness-2.26-2.noarch.rpm;
      wget -q $WEB_ROOT/perl-modules-5.6.1-66.i386.rpm;
      wget -q $WEB_ROOT/redhat-menus-0.26-1.noarch.rpm; 
   fi;
   export prmpt=
   while [ x$prmpt = x ]; do
        read -p "Are you a (S)udoer or do you have the (R)oot password (S/R)? " prmpt leftover;
	case $prmpt in
	    s* | S*)
		echo Installing packages, please enter your password:;
		sudo rpm -i --force *.rpm;;
	    r* | R*)
	     	echo Installing packages, please enter root password:;
      		su -c 'rpm -i --force *.rpm';;
            *)
		export prmpt=;;
	esac
      done
   cd ..
   rm -rf RPMS
fi

if [ -f /etc/debian_version ]; then 
   if fgrep -q -c '3.0' /etc/debian_version; then 
      echo Debian 3.0 detected; 
   fi;
fi

cd ..
export CVS_RSH=ssh
export CVSEDITOR=emacs

while [ x$version = x ]; do
  echo FLEX Versions: 1.3 2.0 3.0 3.1 3.2 latest;
  read -p "What version of FLEX do you want? " version leftover;
  case $version in
	1.3) export version='-r magic-1-3';;
	2.0) export version='-r magic-2-0';;
	3.0) export version='-r magic-3-0';;
	3.1) export version='-r magic-3-1';;
	3.2) export version='-r magic-3-2';;
	latest) export version='-A';;
	*) export version=;;
  esac;
done

while [ x$RTJ = x ]; do
  read -p "Do you want to use Real-Time Java (Y/N)? " RTJ leftover;
  case $RTJ in
     y* | Y*) export RTJ=Y;;
     n* | N*) export RTJ=N;;
     *) export RTJ=;;
  esac;
done

export prmpt=
while [ x$prmpt = x ]; do
   read -p "Do you have read/write access to the FLEX repository (Y/N)? " prmpt leftover;
   case $prmpt in
        y* | Y*)
	   read -p "What's your username on the FLEX CVS server? " pass leftover;
	   echo Please type your password to the FLEX repository:;
           cvs -d :ext:$pass@flex-cvs.csail.mit.edu:/data/cvs co $version Classpath Code Realtime ImageRec Runtime Tests Benchmarks;
	   cd Runtime/Contrib/gc;
           echo Please type your password to the FLEX repository (again):;
	   cvs update -r BOEHM_DIST;
	   echo Please type your password to the FLEX repository (one last time):;
	   cvs update $version;
	   cd -;;
	n* | N*)
	   echo Please type 'cvsguest' as the password.;
	   export CVSROOT=:pserver:cvsguest@flex-cvs.csail.mit.edu:/data/cvs;
	   cvs login;
	   cvs co $version Classpath Code Realtime ImageRec Runtime Tests Benchmarks;
	   cd Runtime/Contrib/gc;
	   cvs update -r BOEHM_DIST;
	   cvs update $version;
	   cd -;;
	*) export prmpt=;;
   esac;
done

cd Classpath
echo Building Classpath...

./build
./build-noGUI
./build-noGUI-debug
./build-arm
	    
cd -
echo Building Runtime...
cd Runtime
./configure --disable-shared --with-gc=conservative --with-precise-c --with-thread-model=heavy --with-classpath=`pwd`/../install-noGUI/lib/classpath CC="gcc -O9 -DNDEBUG"
